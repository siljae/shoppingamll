<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>update-product</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .btn-reset {
      background-color: green;
      color: white;
    }
    .btn-submit {
      background-color: blue;
      color: white;
    }
    .btn-cancel {
      background-color: red;
      color: white;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2>상품 수정</h2>
  <div class="form-group">
    <label for="productName">상품 이름</label>
    <input type="text" class="form-control" id="productName" name="productName" required>
  </div>
  <div class="form-group">
    <label for="productPrice">가격</label>
    <input type="number" class="form-control" id="productPrice" name="productPrice" required>
  </div>
  <div class="form-group">
    <label for="productStock">수량</label>
    <input type="number" class="form-control" id="productStock" name="productStock" required>
  </div>
  <button type="reset" class="btn btn-reset">리셋</button>
  <button type="submit" class="btn btn-submit" id="submitBtn">수정</button>
  <a href="/products" class="btn btn-cancel">취소</a>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get('id');

  $.get(`/api/products/${productId}`)
          .done(function (data) {
            $('#productName').val(data.name);
            $('#productPrice').val(data.price);
            $('#productStock').val(data.stock);
          })
          .fail(function () {
            alert('상품 정보를 가져오지 못했습니다.');
          });

  $(document).ready(function () {
    $('#submitBtn').click(function (event){
      event.preventDefault();
      const newProductName = $('#productName').val();
      const newProductPrice = $('#productPrice').val();
      const newProductStock = $('#productStock').val();

      $.ajax({
        url: `/api/products/${productId}`,
        type: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify({
          id: productId,
          name: newProductName,
          price: newProductPrice,
          stock: newProductStock
        }),
        success: function (){
          alert('상품 수정 완료!');
          window.location.href = '/products';
        },
        error: function (xhr, status, error){
          alert('상품 수정 실패: ' + error);
        }
      });
    });
  });
</script>
</body>
</html>